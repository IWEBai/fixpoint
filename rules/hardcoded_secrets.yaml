rules:
  # Generic password/secret assignments
  - id: python-hardcoded-password
    message: Hardcoded password detected. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    patterns:
      - pattern-either:
          # Variable assignments
          - pattern: $VAR = "..."
          - pattern: $VAR = '...'
      - metavariable-regex:
          metavariable: $VAR
          regex: (?i)(password|passwd|pwd|secret|api_key|apikey|access_key|private_key|auth_token|token|credentials)

  # Dictionary with secrets
  - id: python-hardcoded-secret-dict
    message: Hardcoded secret in dictionary. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    patterns:
      - pattern-either:
          - pattern: |
              {..., "password": "...", ...}
          - pattern: |
              {..., "secret": "...", ...}
          - pattern: |
              {..., "api_key": "...", ...}
          - pattern: |
              {..., "token": "...", ...}
          - pattern: |
              {..., "access_key": "...", ...}

  # Function calls with hardcoded secrets
  - id: python-hardcoded-secret-kwarg
    message: Hardcoded secret in function argument. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    patterns:
      - pattern-either:
          - pattern: $FUNC(..., password="...", ...)
          - pattern: $FUNC(..., secret="...", ...)
          - pattern: $FUNC(..., api_key="...", ...)
          - pattern: $FUNC(..., token="...", ...)
          - pattern: $FUNC(..., auth_token="...", ...)

  # AWS Access Keys
  - id: python-aws-access-key
    message: AWS Access Key ID detected. Use AWS credentials file or environment variables.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: 'AKIA[0-9A-Z]{16}'

  # GitHub Tokens
  - id: python-github-token
    message: GitHub token detected. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: 'gh[pousr]_[A-Za-z0-9_]{36,}'

  # Slack Tokens
  - id: python-slack-token
    message: Slack token detected. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: 'xox[baprs]-[0-9]{10,13}-[0-9]{10,13}-[a-zA-Z0-9]{24}'

  # Stripe Keys
  - id: python-stripe-key
    message: Stripe API key detected. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: 'sk_live_[0-9a-zA-Z]{24,}'

  # SendGrid Keys
  - id: python-sendgrid-key
    message: SendGrid API key detected. Use environment variables instead.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: 'SG\.[A-Za-z0-9_-]{22}\.[A-Za-z0-9_-]{43}'

  # Private Keys
  - id: python-private-key
    message: Private key detected in source code. Store keys securely outside code.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: '-----BEGIN (RSA |EC |OPENSSH )?PRIVATE KEY-----'

  # Database connection strings with credentials
  - id: python-database-uri-credentials
    message: Database connection string with credentials detected. Use environment variables.
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-798"
      owasp: "A07:2021"
    pattern-regex: '(postgres(ql)?|mysql|mongodb(\+srv)?):\/\/[^:]+:[^@]+@'
