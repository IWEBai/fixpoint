rules:
  # os.system with string concatenation or format
  - id: python-command-injection-os-system
    message: Command injection via os.system with user-controlled input
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-78"
      owasp: "A03:2021"
    patterns:
      - pattern-either:
          - pattern: os.system($CMD)
          - pattern: os.system(f"...")
          - pattern: os.system("..." + $VAR)
          - pattern: os.system($VAR + "...")
          - pattern: os.system("...".format(...))

  # subprocess with shell=True and string
  - id: python-command-injection-subprocess-shell
    message: Command injection via subprocess with shell=True and string command
    severity: ERROR
    languages: [python]
    metadata:
      category: security
      confidence: high
      cwe: "CWE-78"
      owasp: "A03:2021"
    patterns:
      - pattern-either:
          - pattern: subprocess.run($CMD, shell=True)
          - pattern: subprocess.call($CMD, shell=True)
          - pattern: subprocess.check_call($CMD, shell=True)
          - pattern: subprocess.check_output($CMD, shell=True)
          - pattern: subprocess.Popen($CMD, shell=True)
